# AWS 오토 스케일링(Auto Scailing)

> 오토스케일링은 Scale-Out 방식으로 서버를 증설할 때 자동으로 서버(리소스)를 관리해주는 기능이다.
> 
- 클라이언트의 요청이 많아져서 서버의 처리 요구량이 증가하면 새 리소스를 자동으로 추가하고 반대로 처리 요구량이 줄어들면 리소스를 감소시켜 적절한 분산 환경을 만들어준다.

## 장점

### 동적 스케일링

- 오토스케일링의 가장 큰 장점은 사용자의 요구 수준에 따라 리소스를 동적으로 스케일링 할 수 있다는 점이다.
- Scale-Out 할 수 있는 서버의 수는 제한이 없고, 필요한 경우 서버 두 대에서 수백~수만 대의 서버로 Scale-Out할 수 있다.

### 로드 밸런싱

- 오토스케일링은 리소스를 동적으로 스케일업 혹은 스케일다운한다.
- 로드밸런서와 함께 사용하면, 다수의 EC2 인스턴스에게 워크로드를 효과적으로 분배할 수 있어서 사용자가 정의한 규칙에 다라 워크로드를 효과적으로 관리할 수 있다.

### 타겟 트래킹

- 사용자는 특정 타겟에 대해서만 오토스케일링을 할 수 있으며, 사용자가 설정한 타겟에 맞춰 EC2 인스턴스의 수를 조정한다.

### 헬스 체크와 서버 플릿 관리

- 오토스케일링을 이용하면 EC2 인스턴스의 헬스 체크 상태를 모니터링 할 수 있다.
- 헬스 체크를 하는 과정에서 특정 인스턴스의 문제가 감지되면, 자동으로 다른 인스턴스로 교체한다.
- 다수의 EC2 서버에서 애플리케이션을 호스팅하는 경우, 이들 일련의 EC2 서버 집합을 AWS는 서버 플릿(Fleet)이라고 부른다.
- 오토스케일링은 적정 수준의 서버 플릿 용량을 유지하는 데 도움을 준다.
- 예를 들어, 어떤 애플리케이션이 6대의 EC2 서버에서 실행 중일 때 6대 서버에 대한 헬스 체크 상태를 모니터링 하다가 특정 서버에 문제가 생기면 즉시 대응 조치를 할 수 있다.
- 한 대 또는 그 이상의 서버가 다운되면 오토스케일링은 6대의 서버 인스턴스 처리 용량을 유지하기 위해 부족분만큼의 서버를 추가로 실행시키는 방식으로 서버 플릿을 유지한다.

## EC2 Auto Scailing 활용

- 오토스케일링은 EC2 인스턴스 뿐만 아니라 다른 인스턴스와도 결합 가능하지만, EC2 사용자에게 가장 인기가 많은 서비스이다.
- EC2 Auto Scailing은 오직 EC2 서버라는 리소스만 대상으로 한다.

### 시작 템플릿(Launch Template)

- Auto Scailing으로 인스턴스를 확장 또는 축소하려면 어떤 서버를 사용할지 결정해야 한다.
- 이는 시작 템플릿을 통해서 가능하며, AMI 상세 정보, 인스턴스 타입, 키 페어, 시큐리티 그룹 등 인스턴스에 대한 모든 정보를 담고 있다.
- 만약 시작 템플릿을 사용하고 있지 않고 시작 템플릯을 생성하지 않으려면 대신 시작 구성을 생성할 수 있다.
- 시작 구성은 EC2 Auto Scailing이 사용자를 위해 생성하는 EC2 인스턴스 유형을 지정한다는 점에서 시작 템플릿과 비슷하다. 사용할 AMI의 ID, 인스턴스 유형, 키 페어, 보안 그룹 등의 정보를 포함시켜서 시작 구성을 생성한다.

### Auto Scailing 그룹 생성

- Auto Scailing 그룹은 스케일업 및 스케일 다운 규칙의 모음으로 EC2 인스턴스 시작부터 삭제까지의 모든 동작에 대한 규칙과 정책을 담고 있다.
- 따라서 Auto Scailing 그룹을 생성하기 위해서는 스케일링 정책 및 유형에 대해서 잘 숙지하고 있어야 한다.

### Scailing 유형

- **인스턴스 레벨 유지**
    - 기본 스케일링 계획으로도 부르며, 형상 실행 상태를 유지하고자 하는 인스턴스의 수를 지정할 수 있다.
    - 일정한 수의 인스턴스가 필요한 경우 최소, 최대 및 원하는 용량에 동일한 값을 설정할 수 있다.
- **수동 스케일링**
    - 기존 Auto Scailing 그룹의 크기를 수동으로 변경할 수 있다.
    - 수동 스케일링을 선택하면 사용자가 직접 콘솔이나 API, CLI 등을 이용해 수동으로 인스턴스를 추가 또는 삭제해야 한다.
    - 추천하지 않는 방식이다.
- **일정별 스케일링**
    - 예측 스케일링 트래픽의 변화를 예측할 수 있고 특정 시간대에 어느 정도의 트래픽이 증가하는지 패턴을 파악하고 있다면 일정별 스케일링을 사용하는 것이 좋다.
    - 예를 들어 낮 시간대에는 트래픽이 최고치에 이르고 밤 시간대에는 트래픽이 거의 없다면 낮 시간대에 서버를 증설하고 밤 시간대에 스케일 다운하는 규칙을 추가하면 된다.
- **동적 스케일링**
    - 수요 변화에 대응하여 Auto Scailing 그룹의 용량을 조정하는 방법을 정의한다.
    - 이 방식은 Cloud Watch가 모니터링 하는 지표를 추적하여 경보 상태일 때 수행할 스케일링 규칙을 정한다.
    - 예를 들어 CPU 처리 용량의 80% 수준까지 급등한 상태가 5분 이상 지속될 경우 Auto Scailing이 작동되서 새 서버를 추가하는 방식이다.
    - 이와 같은 스케일링 정책을 정의할 때는 항상 스케일 업과 스케일 다운 두 가지 정책을 작성해야 한다.