* [목차](#목차)
* [트랜잭션(Transaction)](#트랜잭션transaction)
    + [ACID 원칙](#acid-원칙)   
        + [원자성(Atomicity)](#원자성atomicity)
        + [일관성(Consistancy](#일관성consistancy)
        + [독립성(Isolation)](#독립성isolation)
        + [지속성(Durability)](#지속성durability)
    + [트랜잭션 커밋(commit)과 롤백(rollback)](#트랜잭션-커밋commit과-롤백rollback)
        + [커밋(commit)](#커밋commit)
        + [롤백(rollback)](#롤백rollback)

# 트랜잭션(Transaction)

> 여러개의 작업들을 하나의 그룹으로 묶어서 처리하는 단위. 물리적으로는 여러 개의 작업이지만 논리적으로는 마치 하나의 작업으로 인식해서 전부 성공하든가 전부 실패하든가(All or Nothing)의 둘 중 하나로만 처리되어야 한다.
> 
- All or Nothing이라는 트랜잭션 처리 방식은 애플리케이션에서 사용하는 **데이터의 무결성을 보장**하는 핵심적인 역할을 한다.
- 트랜잭션의 개념을 담은 사례를 몇 가지 들어보자
    - 회원이 커피 주문 앱으로 커피를 주문하고 결제 버튼을 누른 후, 주문이 진행되는 중에 네트워크 오류로 인해 결제를 완료하는데 실패했다. 그런데, 주문이 정상적으로 DB에 등록되고, 주문한 커피 수 만큼의 스탬프가 찍혔다. 이 경우, 카페 사장은 판매 수익을 얻지 못하고 회원은 공짜 커피를 마시게 된다.
    - 회원이 주문한 커피에 대한 결제가 완료되었는데, 데이터베이스에 저장하는 중에 에러가 발생해서 회원이 주문한 커피 주문 정보가 데이터베이스에 정상적으로 등록되지 않았다. 이 경우, 회원은 커피도 마시지 못하고 금전적인 손해만 보게 된다.
    - 회원의 커피 주문은 정상적으로 DB에 등록이 되었는데 스탬프 횟수를 업데이트하는 도중 에러가 발생해서 커피 주문은 완료되었지만 스탬프가 누적되지 않았다. 이 경우, 회원은 커피는 마시지만 스탬프 횟수를 잃게 된다.
- 위 내용처럼 두 개의 작업들이 하나의 그룹처럼 묶여서 처리되는 중에 둘 중 하나라도 처리에 실패할 경우 애플리케이션의 신뢰성이 깨지는 상황이 발생한다. 이를 방지하기 위한 것이 트랜젹션이다.
- 트랜잭션은 데이터베이스에만 한정해서 사용하는 의미는 아니다. 예를 들어 어떤 데이터베이스를 저장하고, 그 결과를 푸시 알림(push notification)으로 클라이언트에게 전송하는 기능이 있다면 데이터베이스 저장과 푸시 알림 전송이라는 두 개의 작업이 하나의 트랜잭션으로 묶여져서 둘 중에 하나라도 실패할 경우 롤백되어야 할 수도 있다.

## ACID 원칙

### 원자성(Atomicity)

> 트랜잭션에서의 원자성이란 작업을 더 이상 쪼갤 수 없음을 의미한다. 다시 말해, 트랜잭션과 관련된 작업들이 부분적으로 실행되다가 중단되지 않는 것을 보장하는 능력이다.
> 
- 예를 들어 자금 이체는 성공할 수도 실패할 수도이 ㅆ지만 보내는 쪽에서 돈을 빼오는 작업만 성공하고 받는 쪽에 돈을 넣는 작업에 실패해서는 안된다.

### 일관성(Consistancy)

> 트랜잭션이 실행을 성공적으로 완료하면 언제나 일관성 있는 DB 상태로 유지하는 것을 의미한다.
> 
- 예를 들어 모든 계좌에 잔고가 있어야 한다면 이를 위반하는 트랜잭션은 중단된다.

### 독립성(Isolation)

> 여러 개의 트랜잭션을 수행 시 각각 독립적으로 실행 되어야 함을 의미한다.
> 
- 격리성을 이해하기 위해서는 CPU가 프로세스를 처리하는 과정을 이해하고 있는 것이 좋다.
- 트랜잭션 밖에 있는 어떤 연산도 중간 단계의 데이터를 볼 수 없다.
- 은행 관리자는 이체 작업을 하는 도중에 쿼리르 실행하더라도 특정 계좌간 이체하는 양 쪽을 볼 수 없다.

### 지속성(Durability)

> 성공적으로 수행된 트랜잭션의 결과는 영원히 반영되어야 함을 의미힌다.
> 
- 시스템 문제, DB 일관성 체크 등을 데이터는 물리적인 저장소에 저장되어 지속적으로 유지되어야 한다.
- 모든 트랜잭션은 로그로 남고 시스템 장애 발생 전 상태로 되돌릴 수 있다.

## 트랜잭션 커밋(commit)과 롤백(rollback)

- 커밋과 롤백은 데이터베이스에서 사용되는 명령어이다.

### 커밋(commit)

- 커밋은 모든 작업을 최종적으로 데이터베이스에 반영하는 명령어로써 commit 명령을 수행하면 변경된 내용이 데이터베이스에 영구적으로 저장된다.
- 만약 commit 명령을 수행하지 않으면 작업의 결과가 데이터베이스에 최종적으로 반영되지 않는다.
- commit 명령을 수행하면, 하나의 트랜잭션 과정은 종료하게 된다.

### 롤백(rollback)

- 롤백은 작업 중 문제가 발생했을 때, 트랜잭션 내에서 수행된 작업들을 취소한다.
- 따라서 트랜잭션 시작 이전의 상태로 되돌아간다.